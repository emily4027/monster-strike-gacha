<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>怪物彈珠抽蛋統計工具</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    
    <!-- 動態背景 -->
    <div class="bg-decoration"></div>

    <div class="container main-container">
        <header class="app-header text-center">
            <div class="icon-badge mx-auto mb-3">📊</div>
            <h1>怪物彈珠抽蛋統計</h1>
        </header>

        <!-- 1. 資料輸入表單 -->
        <div class="section-card">
            <div class="card-header">
                <h2><i class="bi bi-pencil-square"></i> 紀錄編輯</h2>
            </div>
            <form id="gacha-form" class="p-3">
                <!-- 將所有欄位包裹在 fieldset 中，預設禁用 -->
                <fieldset id="gacha-fieldset" class="row g-3" disabled>
                    <div class="col-md-3">
                        <label for="date" class="form-label">日期</label>
                        <input type="date" class="form-control" id="date" required>
                    </div>
                    <!-- Event 欄位 -->
                    <div class="col-md-6" id="event-field-container">
                        <label for="event-select" class="form-label">活動名稱</label>
                        <div class="input-group">
                            <select id="event-select" class="form-select">
                                <!-- 選項會由 JS 動態載入 -->
                            </select>
                            <button type="button" class="btn btn-subtle" id="edit-event-btn" style="display: none;" title="編輯此活動"><i class="bi bi-pencil-square"></i></button>
                        </div>
                        <div id="event-input-group" style="display: none;">
                            <input type="text" id="event-input" class="form-control" placeholder="輸入新活動名稱">
                            <button type="button" id="cancel-new-event" class="btn btn-link btn-sm p-0 mt-1">取消</button>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <label for="tag-select" class="form-label">標籤</label>
                        <select id="tag-select" class="form-select">
                            <option value="none" selected>-- 選擇標籤 --</option>
                            <option value="honke">本家</option>
                            <option value="collab">合作</option>
                            <option value="free">免費</option>
                            <option value="orb">寶珠</option>
                        </select>
                    </div>
                    <div class="col-md-3" id="account-field-container">
                        <label for="account-select" class="form-label">帳號</label>
                        <select id="account-select" class="form-select">
                            <!-- 選項會由 JS 動態載入 -->
                        </select>
                        <div id="account-input-group" style="display: none;">
                            <input type="text" id="account-input" class="form-control" placeholder="輸入新帳號名稱">
                            <button type="button" id="cancel-new-account" class="btn btn-link btn-sm p-0 mt-1">取消</button>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <label for="pulls" class="form-label">投入抽數</label>
                        <input type="number" class="form-control" id="pulls" min="0" required placeholder="例如: 90">
                    </div>
                    <div class="col-md-6">
                        <label for="notes" class="form-label">獲得角色</label>
                        <input type="text" class="form-control" id="notes" placeholder="例如：虹夏*3, 麒麟兒*2 (抽數會自動移除)">
                    </div>
                </fieldset>
                
                <!-- 按鈕列獨立於 fieldset 之外 -->
                <div class="row mt-3">
                    <div class="col-12 d-flex justify-content-between align-items-center">
                        <div> <!-- 儲存/取消按鈕 (左側) -->
                            <button type="submit" class="btn btn-primary"><i class="bi bi-save"></i> <span id="submit-btn-text">儲存紀錄</span></button>
                            <button type="button" class="btn btn-secondary" id="cancel-edit-btn" style="display: none;"><i class="bi bi-x-circle"></i> 取消編輯</button>
                        </div>
                        <div> <!-- 模式切換按鈕 (右側) -->
                            <button type="button" class="btn btn-outline-secondary" id="mode-toggle-btn" title="切換檢視/編輯模式">
                                <i class="bi bi-eye"></i> 
                                <span id="mode-toggle-text">檢視模式 (點此編輯)</span>
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- 2. 統計儀表板 -->
        <div class="section-card mt-4">
            <div class="card-header">
                <h2><i class="bi bi-bar-chart-line-fill"></i> 統計儀表板</h2>
            </div>
            <div id="stats-dashboard" class="p-2">
                <!-- 卡片1: 篩選器 & 總抽數 -->
                <div class="stat-card filter-card">
                    <h5 id="filter-title"><i class="bi bi-filter"></i> 篩選</h5>
                    
                    <label for="account-filter" class="form-label stat-filter-label">帳號</label>
                    <select id="account-filter" class="form-select mb-2">
                        <option value="all">全部帳號</option>
                        <!-- 其他選項由 JS 動態產生 -->
                    </select>

                    <label for="year-filter" class="form-label stat-filter-label">年份</label>
                    <select id="year-filter" class="form-select mb-2">
                        <option value="all">全部年份</option>
                        <!-- 其他選項由 JS 動態產生 -->
                    </select>

                    <label for="month-filter" class="form-label stat-filter-label">月份</label>
                    <select id="month-filter" class="form-select mb-3" disabled>
                        <option value="all">全部月份</option>
                        <!-- 其他選項由 JS 動態產生 -->
                    </select>
                    
                    <h5 id="total-pulls-title" class="mt-3"><i class="bi bi-gem"></i> 總投入抽數</h5>
                    <h3 id="total-pulls">0</h3>
                </div>
                <!-- 卡片2: 各帳號抽數 -->
                <div class="stat-card" id="account-stats">
                    <h5><i class="bi bi-people-fill"></i> 各帳號總抽數</h5>
                    <!-- 內容將由 JavaScript 動態生成 -->
                </div>
                <!-- 卡片3: 各活動抽數 (可滾動) -->
                <div class="stat-card" id="event-stats">
                    <h5><i class="bi bi-calendar-event-fill"></i> 各活動總抽數</h5>
                    <!-- 內容將由 JavaScript 動態生成 (包含滾動區) -->
                </div>
            </div>
        </div>

        <!-- 3. 歷史紀錄表格 -->
        <div class="section-card mt-4">
            <div class="card-header">
                <h2 id="history-table-title"><i class="bi bi-table"></i> 歷史紀錄 (Tidy Data)</h2>
            </div>
            <div class="table-responsive">
                <table class="table table-striped table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>日期</th>
                            <th>活動</th>
                            <th>帳號</th>
                            <th>抽數</th>
                            <th>獲得角色</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="history-table-body">
                        <!-- JS -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- 4. 資料管理 -->
        <div class="section-card mt-4 mb-5">
            <div class="card-header">
                <h2><i class="bi bi-database-fill-gear"></i> 資料管理</h2>
            </div>
            <div class="p-2">
                <div class="btn-group w-100 flex-wrap">
                    <button id="export-data" class="btn btn-success custom-btn m-1"><i class="bi bi-download"></i> 匯出備份</button>
                    <button id="import-data" class="btn btn-info custom-btn m-1 text-white"><i class="bi bi-upload"></i> 匯入備份</button>
                    <button id="clear-data" class="btn btn-danger custom-btn m-1"><i class="bi bi-trash3"></i> 清除資料</button>
                </div>
                <input type="file" id="import-file-input" accept=".json" style="display: none;">
            </div>
        </div>
    </div>

    <!-- 懸浮工具箱菜單 (精準複製圖中結構) -->
    <div class="toolbox-menu-wrapper" title="滑鼠懸停以展開菜單">
        <div class="toolbox-items-list">
            <!-- 項目 (上到下) -->
            <a href="https://emily4027.github.io/monster-strike-toolbox/" class="toolbox-item">
                <i class="bi bi-house-fill"></i> 工具箱首頁
            </a>
            <a href="https://emily4027.github.io/monster-strike-fruit-assign/" class="toolbox-item">
                <i class="bi bi-apple"></i> 果實分配模擬
            </a>
            <a href="https://emily4027.github.io/monster-strike-gacha/" class="toolbox-item active">
                <i class="bi bi-bar-chart-line-fill"></i> 抽卡統計
            </a>
        </div>
        <!-- 主按鈕 (回工具箱) -->
        <a href="https://emily4027.github.io/monster-strike-toolbox/" class="toolbox-main-btn">
            <i class="bi bi-tools"></i> 工具箱
        </a>
    </div>

    <!-- 訊息提示框 -->
    <div id="toast-message"></div>

    <!-- 引入 JavaScript 檔案 -->
    <script src="script.js" defer></script>
</body>

</html>
